generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id         Int         @id @default(autoincrement())
  nome       String?
  email      String?     @unique
  senha      String?
  role       Role
  criadoEm   DateTime    @default(now())
  cursos     Curso[]     @relation("InstrutorCursos")
  feedbacks  Feedback[]
  inscricoes Inscricao[]
  progressos Progresso[]
}

model Curso {
  id          Int         @id @default(autoincrement())
  descricao   String?
  instrutorId Int
  createdAt   DateTime    @default(now())
  nome        String
  updatedAt   DateTime    @updatedAt
  instrutor   Usuario     @relation("InstrutorCursos", fields: [instrutorId], references: [id])
  feedbacks   Feedback[]
  inscricoes  Inscricao[]
  modulos     Modulo[]
  progressos  Progresso[]
  quizzes     Quiz[]
}

model Modulo {
  id           Int         @id @default(autoincrement())
  titulo       String
  tipoConteudo String
  urlConteudo  String?
  cursoId      Int
  curso        Curso       @relation(fields: [cursoId], references: [id])
  progressos   Progresso[]
  quizzes      Quiz[]
}

model Quiz {
  id              Int    @id @default(autoincrement())
  pergunta        String
  opcoes          String
  respostaCorreta String
  moduloId        Int
  cursoId         Int?
  curso           Curso? @relation(fields: [cursoId], references: [id])
  modulo          Modulo @relation(fields: [moduloId], references: [id])
}

model Feedback {
  id         Int      @id @default(autoincrement())
  avaliacao  Int
  comentario String?
  cursoId    Int
  usuarioId  Int
  criadoEm   DateTime @default(now())
  curso      Curso    @relation(fields: [cursoId], references: [id])
  usuario    Usuario  @relation(fields: [usuarioId], references: [id])
}

model Inscricao {
  id        Int      @id @default(autoincrement())
  userId    Int
  cursoId   Int
  createdAt DateTime @default(now())
  curso     Curso    @relation(fields: [cursoId], references: [id])
  usuario   Usuario  @relation(fields: [userId], references: [id])

  @@unique([userId, cursoId])
}

model Progresso {
  id        Int      @id @default(autoincrement())
  userId    Int
  cursoId   Int
  moduloId  Int
  progresso Int      @default(0)
  completed Boolean  @default(false)
  createdAt DateTime @default(now())
  curso     Curso    @relation(fields: [cursoId], references: [id])
  modulo    Modulo   @relation(fields: [moduloId], references: [id])
  usuario   Usuario  @relation(fields: [userId], references: [id])

  @@unique([userId, moduloId])
}

enum Role {
  ALUNO
  INSTRUTOR
}
